name: Daily Commit Report

on:
  schedule:
    - cron: '00 18 * * *'  # Ejecuta todos los dÃ­as a las 18:00 UTC (hora configurada)
  workflow_dispatch:  # Permite ejecuciÃ³n manual desde GitHub Actions

jobs:
  check_commits:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Clonar el repositorio
        uses: actions/checkout@v3

      - name: ðŸ›  Configurar Git
        run: |
          git fetch --all

      - name: ðŸ“Š Verificar commits del dÃ­a
        run: |
          TODAY=$(date -u +"%Y-%m-%d")
          USERS=("DianaCY-ai" "Dihani")
          EMAILS=("diana.carrasco@inetum.com" "dihani.cy@gmail.com")
          COMMITTED_USERS=()
          REPORT="ðŸ” **Reporte de Commits - $TODAY**\n\n"

          for i in "${!USERS[@]}"; do
            USERNAME="${USERS[$i]}"
            EMAIL="${EMAILS[$i]}"

            COUNT=$(git log --since="$TODAY 00:00" --until="$TODAY 18:00" --author="$USERNAME" --pretty=oneline | wc -l)

            if [ "$COUNT" -gt 0 ]; then
              REPORT+="âœ… $USERNAME (${EMAIL}) **subiÃ³ cambios** ($COUNT commits)\n"
              COMMITTED_USERS+=("$USERNAME")
            else
              REPORT+="âŒ $USERNAME (${EMAIL}) **NO subiÃ³ cambios**\n"
            fi
          done

          echo -e "$REPORT" > commit_report.txt
          echo "commit_report<<EOF" >> $GITHUB_ENV
          cat commit_report.txt >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: ðŸ“§ Enviar reporte por correo
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: dihani.cy@gmail.com
          password: ${{ secrets.GMAIL_PASSWORD }}
          subject: "ðŸ“¢ Reporte de commits diarios - ${{ env.TODAY }}"
          body: ${{ env.commit_report }}
          to: diana.carrasco@inetum.com, devdes673@gmail.com
          from: "Reporte de GitHub <dihani.cy@gmail.com>"

