name: Daily Commit Report

on:
  schedule:
  - cron: '00 18 * * *'  # Ejecuta todos los dÃ­as a las 11:59:59 PM UTC

jobs:
  check_commits:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Clonar el repositorio
        uses: actions/checkout@v3

      - name: ğŸ›  Configurar Git
        run: |
          git fetch --all

      - name: ğŸ“Š Verificar commits del dÃ­a
        run: |
          TODAY=$(date -u +"%Y-%m-%d")
          USERS=("DianaCY-ai" "Dihani")
          EMAILS=("diana.carrasco@inetum.com" "dihani.cy@gmail.com")
          COMMITTED_USERS=()
          REPORT="ğŸ” **Reporte de Commits - $TODAY**\n\n"

          for i in "${!USERS[@]}"; do
            USERNAME="${USERS[$i]}"
            EMAIL="${EMAILS[$i]}"

            COUNT=$(git log --since="$TODAY 00:00" --until="$TODAY 18:00" --author="$USERNAME" --pretty=oneline | wc -l)

            if [ "$COUNT" -gt 0 ]; then
              REPORT+="âœ… $USERNAME (${EMAIL}) **subiÃ³ cambios** ($COUNT commits)\n"
              COMMITTED_USERS+=("$USERNAME")
            else
              REPORT+="âŒ $USERNAME (${EMAIL}) **NO subiÃ³ cambios**\n"
            fi
          done

          echo -e "$REPORT" > commit_report.txt
          cat commit_report.txt

      - name: ğŸ“§ Enviar reporte por correo
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: devdes673@gmail.com
          password: ${{ secrets.GMAIL_PASSWORD }}
          subject: "ğŸ“¢ Reporte de commits diarios"
          body: "AquÃ­ estÃ¡ el informe de quiÃ©n subiÃ³ cÃ³digo hoy."
          to: diana.carrasco@inetum.com, ABELOLA@inetum.com
          from: "Reporte de GitHub <devdes673@gmail.com>"
          content_type: text/plain

